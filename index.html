<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snack products - Ricerca</title>
  <style>
    /* --- Stili generali --- */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height:100vh; padding:20px; }
    .container { max-width:1200px; margin:0 auto; background:white; border-radius:20px; padding:40px; box-shadow:0 20px 60px rgba(0,0,0,0.3); }
    h1 { text-align:center; color:#333; margin-bottom:10px; font-size:2.5em; }
    .subtitle { text-align:center; color:#666; margin-bottom:40px; font-size:1.1em; }
    .user-id-display { background:#f0f0f0; padding:10px 20px; border-radius:8px; text-align:center; margin-bottom:30px; font-size:0.9em; color:#666; }

    /* --- Grid prodotti --- */
    .products-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:30px; margin-bottom:40px; }
    .product-card { background:white; border:2px solid #e0e0e0; border-radius:15px; padding:25px; transition:all 0.3s ease; cursor:pointer; }
    .product-card:hover { transform:translateY(-5px); box-shadow:0 10px 30px rgba(0,0,0,0.15); border-color:#667eea; }

    /* --- Immagini prodotti --- */
    .product-image { 
      width:100%; 
      height:200px; 
      background:#f5f5f5; 
      border-radius:10px; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      font-size:4em; 
      margin-bottom:20px; 
      overflow:hidden; 
      position:relative; 
      padding:10px;
    }
    .product-image img { 
      max-width:100%; 
      max-height:100%; 
      width:auto; 
      height:auto; 
      object-fit:contain; 
      display:block; 
    }
    .product-image .emoji-fallback { font-size:4em; }

    /* --- Testi prodotti --- */
    .product-name { font-size:1.4em; font-weight:bold; color:#333; margin-bottom:10px; }
    .product-description { color:#666; margin-bottom:15px; line-height:1.5; }
    .product-price { font-size:1.5em; color:#667eea; font-weight:bold; margin-bottom:15px; }

    /* --- Pulsanti --- */
    .btn-add-cart { width:100%; padding:12px; background:#667eea; color:white; border:none; border-radius:8px; font-size:1em; font-weight:bold; cursor:pointer; transition:all 0.3s ease; }
    .btn-add-cart:hover { background:#5568d3; transform:scale(1.02); }
    .btn-add-cart.added { background:#48bb78; }

    /* --- Carrello --- */
    .cart-summary { background:#f8f9fa; padding:25px; border-radius:15px; margin-bottom:30px; }
    .cart-summary h2 { color:#333; margin-bottom:15px; }
    .cart-item { display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #e0e0e0; }
    .cart-total { font-size:1.5em; font-weight:bold; color:#667eea; margin-top:15px; text-align:right; }
    .empty-cart { text-align:center; color:#999; padding:20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>The Aurum Store</h1>
    <p class="subtitle">All our products are made with 100% Natural Ingredients</p>

    <div class="user-id-display" id="userIdDisplay">Caricamento ID utente...</div>

    <div class="cart-summary">
      <h2>ðŸ›’ Cart</h2>
      <div id="cartItems" class="empty-cart">Your cart is empty</div>
      <div class="cart-total" id="cartTotal"></div>
    </div>

    <div class="products-grid" id="productsGrid"></div>
  </div>

  <script>
    const products = [
      { id:1, name:'Zuegg Blueberry Juice', price:1.5, emoji:'ðŸª', description:'Made with 100% Natural Ingredients', image:'https://www.zuegg.it/wp-content/uploads/2023/11/6x125ml-Mirtillo.webp'},
      { id:2, name:'Zuegg Pear Juice', price:1.5, emoji:'ðŸª', description:'Made with 100% Natural Ingredients', image:'https://www.zuegg.it/wp-content/uploads/2023/11/bar-pera-1.webp' },
      { id:3, name:'Zuegg Peach Jam', price:2.5, emoji:'ðŸª', description:'Made with 100% Natural Ingredients', image:'https://www.zuegg.it/wp-content/uploads/2023/11/320g-pesche.webp' },
      { id:4, name:'Zuegg Strawberry Jam', price:2.5, emoji:'ðŸª', description:'Made with 100% Natural Ingredients', image:'https://www.zuegg.it/wp-content/uploads/2023/11/320g-fragole.webp' },
      { id:5, name:'Zuegg Apricot Preserves', price:3.5, emoji:'ðŸª', description:'Made with 100% Natural Ingredients', image:'https://www.zuegg.it/wp-content/uploads/2023/11/pasticcera-albicocca-1.webp' },
      { id:6, name:'Zuegg Cherry Preserves', price:3.5, emoji:'ðŸª', description:'Made with 100% Natural Ingredients', image:'https://www.zuegg.it/wp-content/uploads/2023/11/pasticcera-ciliegie-1.webp' }
    ];

    let userId = null;
    let cart = [];
    let sessionStart = Date.now();
    const trackingData = [];
    
    // --- Link alla Web App di Google Sheets per tracking ---
    const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbyfnuvFw-dNGXg6G4iaGyEc9wiHY2df5HPFgKAt76ZpB_aV2SN8HxB186yI_WA85CqcOA/exec';

    function getUserIdFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get('uid') || params.get('user_id') || params.get('PROLIFIC_PID') || 'DEMO_' + Date.now();
    }

    function sendToGoogleSheets(event) {
      fetch(GOOGLE_SHEETS_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(event)
      }).catch(console.error);
    }

    function trackEvent(type, productId=null, productPrice=null) {
      const timestamp = new Date().toLocaleString('it-IT', { hour12:false });
      const event = {
        timestamp,
        userId,
        eventType: type,
        productId,
        productName: productId ? products.find(p=>p.id===productId).name : null,
        productPrice,
        sessionDuration: Math.floor((Date.now()-sessionStart)/1000)
      };
      trackingData.push(event);
      console.log('Tracked:', event);
      sendToGoogleSheets(event);
    }

    function renderProducts() {
      const grid = document.getElementById('productsGrid');
      grid.innerHTML = products.map(p => {
        const imgHTML = p.image ? `<img src="${p.image}" alt="${p.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"><div class="emoji-fallback" style="display:none;">${p.emoji}</div>` : `<div class="emoji-fallback">${p.emoji}</div>`;
        return `
          <div class="product-card" onclick="viewProduct(${p.id})">
            <div class="product-image">${imgHTML}</div>
            <div class="product-name">${p.name}</div>
            <div class="product-description">${p.description}</div>
            <div class="product-price">$${p.price.toFixed(2)}</div>
            <button class="btn-add-cart" onclick="addToCart(event, ${p.id})" id="btn-${p.id}">ADD TO CART</button>
          </div>`;
      }).join('');
    }

    function viewProduct(id) { trackEvent('product_view', id, products.find(p=>p
